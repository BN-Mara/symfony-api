{% extends '@SonataAdmin/standard_layout.html.twig' %}
    {% block top_bar_after_nav %} 
        <li>
            <a href="{{ path('acme_demo_hello_index', {'name': 'World'}) }}">
                Maps
            </a>
        </li>
    {% endblock %}

    {% block sonata_admin_content %}
  
    <!-- before the closing <body> tag -->
    

    <div id="map" style="width:100%;height:1000px;"></div>

    <script>
    function myMap() {
    
    var map = new google.maps.Map(document.getElementById("map"), mapOptions);
      var myCenter = new google.maps.LatLng(-4.340912, 15.314222);
      var mapCanvas = document.getElementById("map");
      var mapOptions = {center: myCenter, zoom: 16};
      var map = new google.maps.Map(mapCanvas, mapOptions);
      const shape = {
    coords: [1, 1, 1, 20, 18, 20, 18, 1],
    type: "poly",
  };
  const image = {
    url: "https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png",
    // This marker is 20 pixels wide by 32 pixels high.
    size: new google.maps.Size(20, 32),
    // The origin for this image is (0, 0).
    origin: new google.maps.Point(0, 0),
    // The anchor for this image is the base of the flagpole at (0, 32).
    anchor: new google.maps.Point(0, 32),
  };
  var vehs = JSON.parse('{{ data | json_encode | raw }}');
  
  
  console.log(vehs)
   // Create info window
   var infowindow = new google.maps.InfoWindow({
    maxWidth: 350,
    pixelOffset: new google.maps.Size(-10,-25)
});
var infoFn = function (count) {
            return function (e) {
                var content = '<div>' +
                    '<table class="table table-striped"><tr><td><span>Location:</span> </td><td><span>' + vehs[count].lat+','+vehs[count].lng + '</span></td></tr>' +
                    '<tr><td><span> vehcle: </span> </td><td><span>' + vehs[count].name + '</span></td></tr>' +
                    '<tr><td><span>, id: </span> </td><td><span>' + vehs[count].id + '</span></td></tr>' +
                    '</table></div>';

                infowindow.setContent(content);
                infowindow.open(map);
                infowindow.setPosition(new google.maps.LatLng(vehs[count].lat, vehs[count].lng));
            }
        };


  for (let i = 0; i < vehs.length; i++){

  const marker = new google.maps.Marker({
    position: new google.maps.LatLng(vehs[i].lat, vehs[i].lng),
    map,
    icon: image,
    shape: shape,
    title: vehs[i].name,
    zIndex: vehs[i].id,
      });
    // Add a click listener for each marker, and set up the info window.
    let fn = infoFn(i);
    google.maps.event.addListener(marker, 'click', fn);
      

  }
      
     
      



      //var marker = new google.maps.Marker({position:new google.maps.LatLng(-4.340912, 15.314222),title: "Hello World!",});
      //marker.setMap(map);
      //var marker2 = new google.maps.Marker({position:new google.maps.LatLng(-4.341520371907936, 15.314261195212055),title: "My Hotel",});
      //marker2.setMap(map);
    }
    </script>
    
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDqfML23BjGKn60XGMNDAuUKM_zHRakaQc&callback=myMap"></script>
 
    {% endblock %}